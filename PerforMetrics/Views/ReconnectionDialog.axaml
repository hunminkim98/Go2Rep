<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:PerforMetrics.ViewModels"
        xmlns:models="using:PerforMetrics.Models"
        xmlns:converters="using:PerforMetrics.Converters"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="500"
        x:Class="PerforMetrics.Views.ReconnectionDialog"
        x:DataType="vm:ReconnectionDialogViewModel"
        Title="GoPro 재연결"
        Width="600" Height="500"
        MinWidth="500" MinHeight="400"
        WindowStartupLocation="CenterOwner"
        CanResize="false"
        Background="#F3F4F6">

  <Design.DataContext>
    <vm:ReconnectionDialogViewModel />
  </Design.DataContext>

  <Window.Resources>
    <!-- Converters -->
    <converters:StatusColorConverter x:Key="StatusColorConverter" />
    
    <!-- Color Resources -->
    <SolidColorBrush x:Key="BackgroundBrush" Color="#F3F4F6" />
    <SolidColorBrush x:Key="CardBrush" Color="#FFFFFF" />
    <SolidColorBrush x:Key="BorderBrush" Color="#D1D5DB" />
    <SolidColorBrush x:Key="TextPrimaryBrush" Color="#111827" />
    <SolidColorBrush x:Key="TextSecondaryBrush" Color="#6B7280" />
    <SolidColorBrush x:Key="AccentBrush" Color="#3B82F6" />
    <SolidColorBrush x:Key="SuccessBrush" Color="#10B981" />
    <SolidColorBrush x:Key="DangerBrush" Color="#EF4444" />
    <SolidColorBrush x:Key="WarningBrush" Color="#F59E0B" />
  </Window.Resources>

  <Window.Styles>
    <!-- Button Styles -->
    <Style Selector="Button.primary-btn">
      <Setter Property="Background" Value="{StaticResource AccentBrush}" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Padding" Value="16,8" />
      <Setter Property="CornerRadius" Value="6" />
      <Setter Property="Cursor" Value="Hand" />
      <Setter Property="FontWeight" Value="SemiBold" />
    </Style>

    <Style Selector="Button.primary-btn:pointerover">
      <Setter Property="Background" Value="#2563EB" />
    </Style>

    <Style Selector="Button.secondary-btn">
      <Setter Property="Background" Value="#E5E7EB" />
      <Setter Property="Foreground" Value="#374151" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Padding" Value="12,6" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="Cursor" Value="Hand" />
      <Setter Property="FontSize" Value="13" />
    </Style>

    <Style Selector="Button.secondary-btn:pointerover">
      <Setter Property="Background" Value="#D1D5DB" />
    </Style>

    <Style Selector="Button.danger-btn">
      <Setter Property="Background" Value="{StaticResource DangerBrush}" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Padding" Value="16,8" />
      <Setter Property="CornerRadius" Value="6" />
      <Setter Property="Cursor" Value="Hand" />
      <Setter Property="FontWeight" Value="SemiBold" />
    </Style>

    <Style Selector="Button.danger-btn:pointerover">
      <Setter Property="Background" Value="#DC2626" />
    </Style>
  </Window.Styles>

  <Grid RowDefinitions="Auto,*,Auto" Margin="24">
    
    <!-- Header -->
    <StackPanel Grid.Row="0" Spacing="12" Margin="0,0,0,20">
      <TextBlock Text="GoPro 재연결"
                 FontSize="24"
                 FontWeight="Bold"
                 Foreground="{StaticResource TextPrimaryBrush}" />
      
      <Border Background="{StaticResource CardBrush}"
              BorderBrush="{StaticResource BorderBrush}"
              BorderThickness="1"
              CornerRadius="6"
              Padding="16,12">
        <StackPanel Spacing="8">
          <TextBlock Text="{Binding OverallStatus}"
                     FontSize="14"
                     Foreground="{StaticResource TextPrimaryBrush}"
                     TextWrapping="Wrap" />
          
          <StackPanel Orientation="Horizontal" Spacing="16">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="전체:" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}" />
              <TextBlock Text="{Binding TotalDevices}" FontSize="12" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" />
            </StackPanel>
            
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="성공:" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}" />
              <TextBlock Text="{Binding ReconnectedDevices}" FontSize="12" FontWeight="SemiBold" Foreground="{StaticResource SuccessBrush}" />
            </StackPanel>
            
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="실패:" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}" />
              <TextBlock Text="{Binding FailedDevices}" FontSize="12" FontWeight="SemiBold" Foreground="{StaticResource DangerBrush}" />
            </StackPanel>
          </StackPanel>
        </StackPanel>
      </Border>
    </StackPanel>

    <!-- Device List -->
    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
      <ItemsControl ItemsSource="{Binding DisconnectedDevices}">
        <ItemsControl.ItemTemplate>
          <DataTemplate x:DataType="models:GoProDevice">
            <Border Background="{StaticResource CardBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16"
                    Margin="0,0,0,12">
              <Grid ColumnDefinitions="*,Auto">
                
                <!-- Device Info -->
                <StackPanel Grid.Column="0" Spacing="8">
                  <TextBlock Text="{Binding Name}"
                             FontSize="16"
                             FontWeight="SemiBold"
                             Foreground="{StaticResource TextPrimaryBrush}" />
                  
                  <StackPanel Orientation="Horizontal" Spacing="6">
                    <TextBlock Text="ID:"
                               FontSize="12"
                               Foreground="{StaticResource TextSecondaryBrush}" />
                    <TextBlock Text="{Binding Identifier}"
                               FontSize="12"
                               FontWeight="Medium"
                               Foreground="{StaticResource TextPrimaryBrush}" />
                  </StackPanel>
                  
                  <!-- Status -->
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <Ellipse Width="8" Height="8" VerticalAlignment="Center">
                      <Ellipse.Fill>
                        <SolidColorBrush Color="{Binding Connected, Converter={StaticResource StatusColorConverter}}" />
                      </Ellipse.Fill>
                    </Ellipse>
                    
                    <TextBlock Text="{Binding ReconnectionStatus}"
                               FontSize="13"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               VerticalAlignment="Center" />
                  </StackPanel>
                  
                  <!-- Progress Bar -->
                  <ProgressBar IsIndeterminate="{Binding IsReconnecting}"
                               IsVisible="{Binding IsReconnecting}"
                               Height="4"
                               Margin="0,4,0,0" />
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" 
                           Spacing="8"
                           VerticalAlignment="Center">
                  <Button Classes="secondary-btn"
                          Command="{Binding $parent[Window].((vm:ReconnectionDialogViewModel)DataContext).RetryDeviceCommand}"
                          CommandParameter="{Binding Identifier}"
                          IsEnabled="{Binding !IsReconnecting}"
                          IsVisible="{Binding !Connected}">
                    <TextBlock Text="재시도" />
                  </Button>
                  
                  <Button Classes="secondary-btn"
                          Command="{Binding $parent[Window].((vm:ReconnectionDialogViewModel)DataContext).SkipDeviceCommand}"
                          CommandParameter="{Binding Identifier}"
                          IsEnabled="{Binding !IsReconnecting}"
                          IsVisible="{Binding !Connected}">
                    <TextBlock Text="건너뛰기" />
                  </Button>
                  
                  <Border Background="{StaticResource SuccessBrush}"
                          CornerRadius="4"
                          Padding="12,6"
                          IsVisible="{Binding Connected}">
                    <TextBlock Text="연결됨"
                               FontSize="13"
                               Foreground="White"
                               FontWeight="SemiBold" />
                  </Border>
                </StackPanel>
                
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </ScrollViewer>

    <!-- Footer Buttons -->
    <StackPanel Grid.Row="2" 
                Orientation="Horizontal"
                HorizontalAlignment="Right"
                Spacing="12"
                Margin="0,20,0,0">
      <Button Classes="danger-btn"
              Command="{Binding CancelReconnectionCommand}"
              IsVisible="{Binding IsReconnecting}">
        <TextBlock Text="취소" />
      </Button>
      
      <Button Classes="primary-btn"
              Command="{Binding CloseDialogCommand}"
              IsVisible="{Binding !IsReconnecting}">
        <TextBlock Text="닫기" />
      </Button>
    </StackPanel>

  </Grid>

</Window>

