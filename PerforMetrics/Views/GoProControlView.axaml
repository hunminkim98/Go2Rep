<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:PerforMetrics.ViewModels"
             xmlns:models="using:PerforMetrics.Models"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="PerforMetrics.Views.GoProControlView"
             x:DataType="vm:GoProControlViewModel">

  <Design.DataContext>
    <vm:GoProControlViewModel />
  </Design.DataContext>

  <UserControl.Resources>
    <!-- Color Resources -->
    <SolidColorBrush x:Key="BackgroundBrush" Color="#E5E7EB" />
    <SolidColorBrush x:Key="CardBrush" Color="#FFFFFF" />
    <SolidColorBrush x:Key="BorderBrush" Color="#D1D5DB" />
    <SolidColorBrush x:Key="TextPrimaryBrush" Color="#111827" />
    <SolidColorBrush x:Key="TextSecondaryBrush" Color="#6B7280" />
    <SolidColorBrush x:Key="AccentBrush" Color="#3B82F6" />
    <SolidColorBrush x:Key="SuccessBrush" Color="#10B981" />
    <SolidColorBrush x:Key="DangerBrush" Color="#EF4444" />
    <SolidColorBrush x:Key="WarningBrush" Color="#F59E0B" />
  </UserControl.Resources>

  <UserControl.Styles>
    <!-- Control Button Style -->
    <Style Selector="Button.control-btn">
      <Setter Property="Background" Value="{StaticResource AccentBrush}" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Padding" Value="20,10" />
      <Setter Property="CornerRadius" Value="6" />
      <Setter Property="Cursor" Value="Hand" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="FontSize" Value="14" />
    </Style>

    <Style Selector="Button.control-btn:pointerover">
      <Setter Property="Background" Value="#2563EB" />
    </Style>

    <Style Selector="Button.control-btn:disabled">
      <Setter Property="Background" Value="#9CA3AF" />
      <Setter Property="Cursor" Value="Arrow" />
    </Style>

    <Style Selector="Button.control-btn.danger">
      <Setter Property="Background" Value="{StaticResource DangerBrush}" />
    </Style>

    <Style Selector="Button.control-btn.danger:pointerover">
      <Setter Property="Background" Value="#DC2626" />
    </Style>

    <!-- Card Button Style -->
    <Style Selector="Button.card-btn">
      <Setter Property="Background" Value="{StaticResource AccentBrush}" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Padding" Value="12,6" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="Cursor" Value="Hand" />
      <Setter Property="FontSize" Value="12" />
      <Setter Property="HorizontalAlignment" Value="Stretch" />
    </Style>

    <Style Selector="Button.card-btn:pointerover">
      <Setter Property="Background" Value="#2563EB" />
    </Style>

    <Style Selector="Button.card-btn.secondary">
      <Setter Property="Background" Value="#6B7280" />
    </Style>

    <Style Selector="Button.card-btn.secondary:pointerover">
      <Setter Property="Background" Value="#4B5563" />
    </Style>
  </UserControl.Styles>

  <Grid Background="{StaticResource BackgroundBrush}">
    <!-- Main Content - GoPro Cards Grid -->
    <ScrollViewer
                  VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled"
                  Padding="24,16">
      <StackPanel Spacing="16">
        
        <!-- Control Buttons Bar -->
        <Border Background="{StaticResource CardBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="16">
          <StackPanel Orientation="Horizontal"
                      HorizontalAlignment="Center"
                      Spacing="12">
            
            <Button Classes="control-btn"
                    Command="{Binding ScanDevicesCommand}"
                    IsEnabled="{Binding !IsLoading}">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <PathIcon Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                          Width="16" Height="16"
                          Foreground="White" />
                <TextBlock Text="스캔" />
              </StackPanel>
            </Button>

            <Button Classes="control-btn"
                    Command="{Binding OpenWiFiSettingsCommand}"
                    IsEnabled="{Binding !IsLoading}"
                    Background="#9C27B0">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <PathIcon Data="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"
                          Width="16" Height="16"
                          Foreground="White" />
                <TextBlock Text="WiFi 설정" />
              </StackPanel>
            </Button>

            <Button Classes="control-btn"
                    Command="{Binding StartAllRecordingCommand}"
                    IsEnabled="{Binding !IsLoading}">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"
                          Width="16" Height="16"
                          Foreground="White" />
                <TextBlock Text="전체 녹화" />
              </StackPanel>
            </Button>

            <Button Classes="control-btn danger"
                    Command="{Binding StopAllRecordingCommand}"
                    IsEnabled="{Binding !IsLoading}">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <PathIcon Data="M6 6h12v12H6z"
                          Width="16" Height="16"
                          Foreground="White" />
                <TextBlock Text="전체 중지" />
              </StackPanel>
            </Button>

          </StackPanel>
        </Border>
        
        <!-- Status Message -->
        <Border Background="{StaticResource CardBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="6"
                Padding="16,12"
                IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
          <TextBlock Text="{Binding StatusMessage}"
                     Foreground="{StaticResource TextSecondaryBrush}"
                     FontSize="13"
                     TextWrapping="Wrap" />
        </Border>

        <!-- GoPro Cards -->
        <ItemsControl ItemsSource="{Binding GoProDevices}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <WrapPanel Orientation="Horizontal" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>

          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="models:GoProDevice">
              <Border Background="{StaticResource CardBrush}"
                      BorderBrush="{StaticResource BorderBrush}"
                      BorderThickness="1"
                      CornerRadius="8"
                      Padding="16"
                      Width="280"
                      Height="240"
                      Margin="0,0,16,16">
                <Grid RowDefinitions="Auto,*,Auto">
                  
                  <!-- Header -->
                  <StackPanel Grid.Row="0" Spacing="8">
                    <TextBlock Text="{Binding Name}"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}" />
                    
                    <!-- Status Indicator -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                      <Ellipse Width="10" Height="10" VerticalAlignment="Center">
                        <Ellipse.Fill>
                          <SolidColorBrush Color="{Binding Connected, Converter={StaticResource StatusColorConverter}}" />
                        </Ellipse.Fill>
                      </Ellipse>
                      <TextBlock Text="{Binding Connected, Converter={StaticResource BoolToStringConverter}, ConverterParameter='연결됨|준비됨'}"
                                 FontSize="12"
                                 Foreground="{StaticResource TextSecondaryBrush}"
                                 VerticalAlignment="Center" />
                    </StackPanel>
                  </StackPanel>

                  <!-- Device Info -->
                  <StackPanel Grid.Row="1" 
                              Spacing="6"
                              Margin="0,12,0,0">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                      <TextBlock Text="ID:"
                                 FontSize="12"
                                 Foreground="{StaticResource TextSecondaryBrush}" />
                      <TextBlock Text="{Binding Identifier}"
                                 FontSize="12"
                                 FontWeight="Medium"
                                 Foreground="{StaticResource TextPrimaryBrush}" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Spacing="6"
                                IsVisible="{Binding IpAddress, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                      <TextBlock Text="IP:"
                                 FontSize="12"
                                 Foreground="{StaticResource TextSecondaryBrush}" />
                      <TextBlock Text="{Binding IpAddress}"
                                 FontSize="12"
                                 Foreground="{StaticResource TextPrimaryBrush}" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Spacing="6"
                                IsVisible="{Binding CertificateExists}">
                      <PathIcon Data="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"
                                Width="12" Height="12"
                                Foreground="{StaticResource SuccessBrush}"
                                VerticalAlignment="Center" />
                      <TextBlock Text="COHN 인증서"
                                 FontSize="11"
                                 Foreground="{StaticResource SuccessBrush}"
                                 VerticalAlignment="Center" />
                    </StackPanel>
                  </StackPanel>

                  <!-- Action Buttons -->
                  <StackPanel Grid.Row="2" Spacing="8">
                    <Button Classes="card-btn"
                            Command="{Binding $parent[UserControl].((vm:GoProControlViewModel)DataContext).ToggleDeviceRecordingCommand}"
                            CommandParameter="{Binding Identifier}"
                            IsEnabled="{Binding Connected}">
                      <TextBlock Text="녹화" />
                    </Button>
                    
                    <Button Classes="card-btn secondary"
                            Command="{Binding $parent[UserControl].((vm:GoProControlViewModel)DataContext).OpenDeviceSettingsCommand}"
                            CommandParameter="{Binding Identifier}"
                            IsEnabled="{Binding Connected}">
                      <TextBlock Text="설정" />
                    </Button>

                    <Button Classes="card-btn secondary"
                            Command="{Binding $parent[UserControl].((vm:GoProControlViewModel)DataContext).ConnectDeviceCommand}"
                            CommandParameter="{Binding Identifier}"
                            IsVisible="{Binding !Connected}">
                      <TextBlock Text="연결" />
                    </Button>
                  </StackPanel>

                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

      </StackPanel>
    </ScrollViewer>

  </Grid>

</UserControl>

